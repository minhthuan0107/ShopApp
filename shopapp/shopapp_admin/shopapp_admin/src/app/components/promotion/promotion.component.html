<div class="container-fluid coupon-table-container">
  <!-- Ti√™u ƒë·ªÅ -->
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800 title-shift-up">üè∑Ô∏è Danh s√°ch m√£ gi·∫£m gi√°</h1>
    <div class="d-flex justify-content-end mb-3 add-coupon-wrapper">
      <app-add-coupon (couponAdded)="onCouponAdded()"></app-add-coupon>
    </div>
  </div>

  <!-- T√¨m ki·∫øm -->
  <div class="search-wrapper mb-3">
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>T√¨m ki·∫øm m√£ gi·∫£m gi√°</mat-label>
      <input matInput [(ngModel)]="keyword" placeholder="Nh·∫≠p m√£, lo·∫°i, gi√° tr·ªã..." (keyup)="applyFilter()">
      <button mat-icon-button matSuffix disabled>
        <mat-icon>search</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <!-- B·∫£ng d·ªØ li·ªáu -->
  <div class="table-wrapper">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 custom-table">

      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
        <td mat-cell *matCellDef="let row">{{ row.id }}</td>
      </ng-container>

      <!-- M√£ -->
      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>M√£</th>
        <td mat-cell *matCellDef="let row">{{ row.code }}</td>
      </ng-container>

      <!-- Lo·∫°i -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Lo·∫°i</th>
        <td mat-cell *matCellDef="let row">{{ row.type }}</td>
      </ng-container>

      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Gi√° tr·ªã</th>
        <td mat-cell *matCellDef="let row">
          <ng-container *ngIf="row.type === 'fixed'; else percent">
            {{ row.value | number:'1.0-0' }} ‚Ç´
          </ng-container>
          <ng-template #percent>
            {{ row.value }}%
          </ng-template>
        </td>
      </ng-container>

      <!-- Gi√° tr·ªã ƒë∆°n t·ªëi thi·ªÉu -->
      <ng-container matColumnDef="min_order_value">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Gi√° tr·ªã t·ªëi thi·ªÉu</th>
        <td mat-cell *matCellDef="let row"> {{ row.min_order_value | number:'1.0-0' }} ‚Ç´</td>
      </ng-container>

      <!-- S·ªë l∆∞·ª£ng -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>S·ªë l∆∞·ª£ng</th>
        <td mat-cell *matCellDef="let row">{{ row.quantity }}</td>
      </ng-container>

      <!-- Ng√†y h·∫øt h·∫°n -->
      <ng-container matColumnDef="expiry_date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Ng√†y h·∫øt h·∫°n</th>
        <td mat-cell *matCellDef="let row">{{ row.expiry_date | date: 'dd-MM-yyyy' }}</td>
      </ng-container>

      <!-- Tr·∫°ng th√°i -->
      <ng-container matColumnDef="is_active">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Tr·∫°ng th√°i</th>
        <td mat-cell *matCellDef="let row">
          <span [ngClass]="row.is_active ? 'text-success' : 'text-danger'">
            {{ row.is_active ? 'Ho·∫°t ƒë·ªông' : 'H·∫øt h·∫°n / T·∫Øt' }}
          </span>
        </td>
      </ng-container>

      <!-- H√†nh ƒë·ªông (n·∫øu c√≥ th·ªÉ th√™m cu·ªëi) -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>H√†nh ƒë·ªông</th>
        <td mat-cell *matCellDef="let row">
          <button mat-icon-button [color]="row.is_active ? 'warn' : 'primary'" (click)="toggleCouponStatus(row)"
            [matTooltip]="row.is_active ? 'T·∫Øt m√£' : 'B·∫≠t m√£'">
            <mat-icon>{{ row.is_active ? 'toggle_off' : 'toggle_on' }}</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Header v√† Row -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- Ph√¢n trang -->
    <mat-paginator [length]="totalItems" [pageSize]="6" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons
      (page)="onPageChange($event)">
    </mat-paginator>
  </div>

  <div *ngIf="dataSource.data.length === 0" class="no-records-message">
    ‚ùå Kh√¥ng t√¨m th·∫•y m√£ gi·∫£m gi√° n√†o ph√π h·ª£p v·ªõi t·ª´ kh√≥a "{{ keyword }}"
  </div>
</div>